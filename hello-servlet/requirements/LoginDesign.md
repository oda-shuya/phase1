# **会員登録機能およびログイン機能の設計書**

## **1. 機能要件**

### **1.1 会員登録機能**

#### **必須要件**

- ユーザーはWebフォームから以下の情報を入力し、会員登録できる。
  - ユーザー名（半角英数字、必須）
  - メールアドレス（形式チェック、必須）
  - パスワード（8文字以上、必須）
  - パスワード確認（パスワードと一致する必要あり）
- 入力情報のバリデーションを行う。

### **1.2 ログイン機能**

#### **必須要件**

- ユーザーはメールアドレスとパスワードでログインできる。
- パスワードはハッシュ化（例: BCrypt）して保存。
- ログイン成功時にセッションを開始し、ユーザー情報を保持する。
- ログイン失敗時は適切なエラーメッセージを表示する。
- セッションタイムアウト（例: 30分）を設定。

## **2. システム設計**

### **2.1 システム構成**

- **フロントエンド**: HTML, CSS, JavaScript（JSPも使用可）
- **バックエンド**: Java
- **データベース**: MySQL
- **インフラ**: Tomcat

### **2.2 データベース設計**

#### **users テーブル**

| カラム名       | 型              | 制約                        |
|--------------|---------------|---------------------------|
| id           | INT           | PRIMARY KEY, AUTO_INCREMENT |
| username     | VARCHAR(50)   | NOT NULL, UNIQUE         |
| email        | VARCHAR(255)  | NOT NULL, UNIQUE         |
| password     | VARCHAR(255)  | NOT NULL                 |
| created_at   | TIMESTAMP     | DEFAULT CURRENT_TIMESTAMP |
| updated_at   | TIMESTAMP     | ON UPDATE CURRENT_TIMESTAMP |
| is_verified  | BOOLEAN       | DEFAULT FALSE             |

### **2.3 Servlet 設計**

#### **RegisterServlet**（会員登録）

- **HTTPメソッド**: `POST`
- **処理フロー**:
  1. フォームの入力バリデーションを実施。
  2. メールアドレスの重複チェック。
  3. パスワードをハッシュ化して保存。
  4. 認証メールを送信。
  5. 成功/失敗のレスポンスを返す。

#### **LoginServlet**（ログイン）

- **HTTPメソッド**: `POST`
- **処理フロー**:
  1. 入力値のバリデーション。
  2. メールアドレスに対応するハッシュ化パスワードの照合。
  3. 認証成功時にセッションを開始。
  4. 失敗時はエラーメッセージを返す。

#### **LogoutServlet**（ログアウト）

- **HTTPメソッド**: `GET`
- **処理フロー**:
  1. セッションを無効化。
  2. ログインページへリダイレクト。

## **3. API設計**

### **3.1 エンドポイント一覧**

| エンドポイント | メソッド | 説明 |
|--------------|--------|------|
| `/register` | POST   | 会員登録処理 |
| `/login`    | POST   | ログイン処理 |
| `/logout`   | GET    | ログアウト処理 |

### **3.2 API レスポンス例**

#### **登録成功時**

```json
{
  "status": "success",
  "message": "登録が完了しました。認証メールをご確認ください。"
}
```

#### **ログイン成功時**

```json
{
  "status": "success",
  "message": "ログインに成功しました。"
}
```

#### **エラー例（認証失敗）**

```json
{
  "status": "error",
  "message": "メールアドレスまたはパスワードが間違っています。"
}
```

## **4. セキュリティ対策**

- パスワードのハッシュ化（BCrypt）
- セッション管理（タイムアウト、Secure Cookie）

## **5. ユーザーフロー**

1. ユーザーが`/register`で会員登録。
2. メール認証完了後、`/login`でログイン。
3. 認証成功時にセッションが発行され、ユーザー情報を保持。
4. ユーザーが`/logout`を実行すると、セッションが破棄される。

---

この設計をベースに、Servletを用いて開発を進める。
